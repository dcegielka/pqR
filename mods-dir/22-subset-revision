Changes to subset.c that clean it up and speed it up a bit.
